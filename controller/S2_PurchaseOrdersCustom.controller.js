sap.ui.define(["sap/ui/Device","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/FilterType","nw/epm/refapps/purchaseorders/approve/controller/BaseController"],function(e,t,i,s,r,o){"use strict";return sap.ui.controller("nw.epm.refapps.purchaseorders.approve.ZSAMPLE_PO_APVExtension.controller.S2_PurchaseOrdersCustom",{onInit:function(){this._oApplication=this.getApplication();this._oList=this.byId("poList");this._oPullToRefresh=this.byId("pullToRefresh");this._oListFilterState={aSearch:[]};this._iRunningListUpdates=0;this._initializeViewModel();this._oApplication.oListSelector.setBoundMasterList(this._oList);var e=this._getInitialFilterFromStartupParameters();if(e){this.byId("searchField").setValue(e);this.getRouter().attachEventOnce("routePatternMatched",this._setSearch.bind(this,e))}},_initializeViewModel:function(){this._oViewModel=new t({itemCount:-1,originalBusyDelayList:this._oList.getBusyIndicatorDelay()});this.setModel(this._oViewModel,"viewProperties")},_getInitialFilterFromStartupParameters:function(){var e=this.getOwnerComponent().getComponentData();if(e&&e.startupParameters&&jQuery.isArray(e.startupParameters.Product)&&e.startupParameters.Product.length>0){return e.startupParameters.Product[0]}return""},onUpdateFinished:function(){this._updateListItemCount();this._oPullToRefresh.hide();var t=this.getGlobalModel();t.setProperty("/masterImmediateBusy",false);if(e.system.phone){t.setProperty("/detailImmediateBusy",false)}if(e.system.phone||this._isMultiSelect()||t.getProperty("/currentPOId")){t.setProperty("/isBusyApproving",false)}else{this._findItemToDisplay()}},_updateListItemCount:function(){var e=this._getListBinding().getLength();this._oViewModel.setProperty("/itemCount",e);if(e===0){var t=this._oListFilterState.aSearch.length?"masterListNoDataWithFilterOrSearchText":"masterListNoDataText",i=this.getResourceBundle();this.getGlobalModel().setProperty("/listNoDataText",i.getText(t))}},_findItemToDisplay:function(){var e=this.getGlobalModel();var t=e.getProperty("/preferredIds");e.setProperty("/preferredIds",[]);var i=null;for(var s=0;s<t.length&&!i;s++){i=this._getItemForId(t[s])}i=i||this._oList.getItems()[0];if(i){this._showDetail(i)}else{this._oApplication.showEmptyView("noObjects")}},onSearch:function(e){if(e.getParameters().refreshButtonPressed){this.onRefresh();return}var t=e.getParameter("query");this._setSearch(t);this._oApplication.whenMetadataIsFinished()},_setSearch:function(e){if(e){this._oListFilterState.aSearch=[new i({filters:[new i("SupplierName",s.Contains,e),new i("ProductId",s.EQ,e)],and:false})]}else{this._oListFilterState.aSearch=[]}this._getListBinding().filter(this._oListFilterState.aSearch,r.Application)},onRefresh:function(){this._oApplication.whenMetadataIsFinished(function(e){if(e){this._getListBinding().refresh()}else{this._oPullToRefresh.hide()}}.bind(this))},onSelectPressed:function(e){var t=e.getParameter("listItem")||e.getSource();if(this._isMultiSelect()){if(this.getGlobalModel().getProperty("/isBusyApproving")){return}this._itemCheckedChanged(t)}else{this._showDetail(t)}},onMultiSelectPressed:function(){var t=this.getGlobalModel(),i=this._isMultiSelect();if(i){if(!e.system.phone){t.setProperty("/preferredIds",[t.getProperty("/currentPOId")]);t.setProperty("/currentPOId",null)}this._oList.removeSelections(true);if(!e.system.phone){this._showSummaryPage()}}else if(!e.system.phone){this._oList.removeSelections(true);this._findItemToDisplay()}},onProcessPressed:function(){this._showSummaryPage()},onNavButtonPressed:function(){alert("this is Back Button Navigation using the Controller Extention functionallity");this._oApplication.navBack(true,false)},onSwipe:function(e){if(this._isMultiSelect()||this.getGlobalModel().getProperty("/isBusyApproving")||this._oApplication.oApprover.isSwipeApproving(this._getIdForItem(e.getParameter("listItem")))){e.preventDefault()}},onSwipeApprove:function(){var e=[this._getIdForItem(this._oList.getSwipedItem())];this._oApplication.oApprover.approve(true,true,this.getView(),e,"");this._oList.swipeOut()},_showDetail:function(t){var i=!e.system.phone,s=["detail","master"];t.setSelected(true);this.getRouter().getTargets().display(s);this.getRouter().navTo("PurchaseOrderDetails",{POId:encodeURIComponent(this._getIdForItem(t))},i)},_isMultiSelect:function(){return this.getGlobalModel().getProperty("/isMultiSelect")},_showSummaryPage:function(){var e=["master","summary"];this.getRouter().getTargets().display(e)},_itemCheckedChanged:function(e){var t=e.getSelected(),i=this.getGlobalModel(),s=i.getProperty("/selectedPurchaseOrders").slice(0);if(t){var r=this.getModel().getObject(e.getBindingContextPath());s.push(r)}else{var o=this._getIdForItem(e);for(var a=0;a<s.length;a++){if(s[a].POId===o){s.splice(a,1);break}}}i.setProperty("/selectedPurchaseOrders",s)},_getListBinding:function(){return this._oList.getBinding("items")},_getItemForId:function(e){var t=this._oList.getItems();for(var i=0;i<t.length;i++){if(e===this._getIdForItem(t[i])){return t[i]}}},_getIdForItem:function(e){return e.getBindingContext().getProperty("POId")}})});